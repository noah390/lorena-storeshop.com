<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Email Signup - Lorena Store</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        .btn { padding: 15px 30px; margin: 10px; background: #e75480; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        .result { margin: 20px 0; padding: 15px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test Email Signup & Login</h1>
        <p>Test the email authentication system without Google OAuth issues.</p>
        
        <div>
            <h3>Create Test Account</h3>
            <div class="form-group">
                <label>Full Name:</label>
                <input type="text" id="testName" placeholder="Enter full name" value="Test User">
            </div>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="testEmail" placeholder="Enter email" value="testuser@example.com">
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" id="testPassword" placeholder="Enter password (min 6 chars)" value="123456">
            </div>
            <button class="btn" onclick="testSignup()">Create Account</button>
        </div>
        
        <hr style="margin: 30px 0;">
        
        <div>
            <h3>Login to Existing Account</h3>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="loginEmail" placeholder="Enter email" value="testuser@example.com">
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" id="loginPassword" placeholder="Enter password" value="123456">
            </div>
            <button class="btn" onclick="testLogin()">Login</button>
        </div>
        
        <div>
            <h3>Quick Actions</h3>
            <button class="btn" onclick="checkCurrentUser()">Check Current User</button>
            <button class="btn" onclick="signOutUser()">Sign Out</button>
            <button class="btn" onclick="goToProfile()">Go to Profile</button>
        </div>
        
        <div id="results"></div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage-compat.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        function showResult(message, type = 'success') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            
            // Auto-scroll to result
            div.scrollIntoView({ behavior: 'smooth' });
        }

        async function testSignup() {
            try {
                const { auth, db } = window.firebaseServices;
                const name = document.getElementById('testName').value.trim();
                const email = document.getElementById('testEmail').value.trim();
                const password = document.getElementById('testPassword').value;

                if (!name || !email || !password) {
                    showResult('❌ Please fill in all fields', 'error');
                    return;
                }

                if (password.length < 6) {
                    showResult('❌ Password must be at least 6 characters', 'error');
                    return;
                }

                // Create user account
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Update profile
                await user.updateProfile({ displayName: name });

                // Save to Firestore
                await db.collection('users').doc(user.uid).set({
                    name: name,
                    email: email,
                    photoURL: '',
                    provider: 'email',
                    createdAt: new Date(),
                    phone: ''
                });

                showResult(`✅ Account created successfully!<br>
                    <strong>User ID:</strong> ${user.uid}<br>
                    <strong>Email:</strong> ${user.email}<br>
                    <strong>Name:</strong> ${user.displayName}<br>
                    <strong>Status:</strong> Signed in and saved to Firestore`);

            } catch (error) {
                showResult('❌ Signup failed: ' + error.message, 'error');
            }
        }

        async function testLogin() {
            try {
                const { auth } = window.firebaseServices;
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value;

                if (!email || !password) {
                    showResult('❌ Please enter email and password', 'error');
                    return;
                }

                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;

                showResult(`✅ Login successful!<br>
                    <strong>User ID:</strong> ${user.uid}<br>
                    <strong>Email:</strong> ${user.email}<br>
                    <strong>Name:</strong> ${user.displayName}<br>
                    <strong>Last Sign In:</strong> ${new Date(user.metadata.lastSignInTime).toLocaleString()}`);

            } catch (error) {
                showResult('❌ Login failed: ' + error.message, 'error');
            }
        }

        async function checkCurrentUser() {
            try {
                const { auth } = window.firebaseServices;
                const user = auth.currentUser;

                if (user) {
                    showResult(`✅ User is signed in:<br>
                        <strong>User ID:</strong> ${user.uid}<br>
                        <strong>Email:</strong> ${user.email}<br>
                        <strong>Name:</strong> ${user.displayName}<br>
                        <strong>Email Verified:</strong> ${user.emailVerified}`);
                } else {
                    showResult('ℹ️ No user is currently signed in', 'error');
                }
            } catch (error) {
                showResult('❌ Error checking user: ' + error.message, 'error');
            }
        }

        async function signOutUser() {
            try {
                const { auth } = window.firebaseServices;
                await auth.signOut();
                showResult('✅ User signed out successfully');
            } catch (error) {
                showResult('❌ Sign out failed: ' + error.message, 'error');
            }
        }

        function goToProfile() {
            window.location.href = 'profile.html';
        }

        // Wait for Firebase to load
        function waitForFirebase() {
            if (window.firebaseServices) {
                showResult('✅ Firebase services loaded successfully!');
                
                // Monitor auth state
                const { auth } = window.firebaseServices;
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        console.log('User signed in:', user.email);
                    } else {
                        console.log('User signed out');
                    }
                });
            } else {
                setTimeout(waitForFirebase, 100);
            }
        }

        document.addEventListener('DOMContentLoaded', waitForFirebase);
    </script>
</body>
</html>